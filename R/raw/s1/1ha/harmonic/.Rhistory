S1_Phase_Peak <- S1_season$phase_peak %>% median(na.rm=T) ; S1_Phase_Peak_IQR <- S1_season$phase_peak %>% IQR(na.rm=T)
S1_Phase_Season <- S1_season$phase_seas %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_season %>% IQR(na.rm=T)
S1_Phase_Ensemble <- median(S1_Phase_Peak, S1_Phase_Season) ; S1_Phase_Ensemble_IQR <- c(S1_season$phase_seas, S1_season$peak) %>% IQR(na.rm=T) %>% sum()
#S1 phenometrics (circular statistics)
S1_season_start_rad <- S1_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_start_rad_rho <- S1_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_end_rad <- S1_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_end_rad_rho <- S1_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_rad_def <- c(0, S1_season_start_rad[1], S1_season_end_rad[1], 2*pi)
S1_Phase_Peak_rad <- S1_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Peak_rad_rho <- S1_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Season_rad <- S1_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Season_rad_rho <- S1_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Ensemble_rad <- S1_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Ensemble_rad_rho <- S1_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#S2 phenometrics (conventional statistics)
S2_season_start <- S2_season$season_start_date %>% yday %>% median(na.rm=T)
S2_season_end <- S2_season$season_end_date %>% yday %>% median(na.rm=T)
S2_season_def <- c(0, S2_season_start, S2_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S2_season_start > S2_season_end) {S2_season_def[c(2,3)] <- S2_season_def[c(3,2)]}
S2_Ampl <- S2_season$Ampl. %>% median(na.rm=T) ; S2_Ampl_IQR <- S2_season$Ampl. %>% IQR(na.rm=T)
S2_Phase_Peak <- S2_season$phase_peak %>% median(na.rm=T) ; S2_Phase_Peak_IQR <- S2_season$phase_peak %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_seas %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_season %>% IQR(na.rm=T)
S2_Phase_Ensemble <- median(S2_Phase_Peak, S2_Phase_Season) ; S2_Phase_Ensemble_IQR <- c(S2_season$phase_seas, S2_season$peak) %>% IQR(na.rm=T) %>% sum()
#S2 phenometrics (circular statistics)
S2_season_start_rad <- S2_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_start_rad_rho <- S2_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_end_rad <- S2_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_end_rad_rho <- S2_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_rad_def <- c(0, S2_season_start_rad[1], S2_season_end_rad[1], 2*pi)
S2_Phase_Peak_rad <- S2_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Peak_rad_rho <- S2_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Season_rad <- S2_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Season_rad_rho <- S2_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Ensemble_rad <- S2_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Ensemble_rad_rho <- S2_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#Calculate Phase Differences (S1/S2)
S1_S2_Phase_Peak <- doy_diff_fixed(S1_Phase_Peak, S2_Phase_Peak)
S1_S2_Phase_Peak_rad <- circular_diff_fixed(S1_Phase_Peak_rad,S2_Phase_Peak_rad)
S1_S2_Phase_Peak_IQR <- S2_season$phase_peak - S1_season$phase_peak[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Peak_IQR <- S1_S2_Phase_Peak_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Peak_rad_rho <- circular(S2_season$phase_peak_rad) - circular(S1_season$phase_peak_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Peak_rad_rho <- S1_S2_Phase_Peak_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Season <- doy_diff_fixed(S1_Phase_Season, S2_Phase_Season)
S1_S2_Phase_Season_rad <- circular_diff_fixed(S1_Phase_Season_rad,S2_Phase_Season_rad)
S1_S2_Phase_Season_IQR <- S2_season$phase_season - S1_season$phase_season[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Season_IQR <- S1_S2_Phase_Season_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Season_rad_rho <- circular(S2_season$phase_season_rad) - circular(S1_season$phase_season_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Season_rad_rho <- S1_S2_Phase_Season_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Ensemble <- doy_diff_fixed(S1_Phase_Ensemble, S2_Phase_Ensemble)
S1_S2_Phase_Ensemble_rad <- circular_diff_fixed(S1_Phase_Ensemble_rad,S2_Phase_Ensemble_rad)
S1_S2_Phase_Ensemble_IQR <- S2_season$phase_ensemble - S1_season$phase_ensemble[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Ensemble_IQR <- S1_S2_Phase_Ensemble_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Ensemble_rad_rho <- circular(S2_season$phase_ensemble_rad) - circular(S1_season$phase_ensemble_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Ensemble_rad_rho <- S1_S2_Phase_Ensemble_rad_rho %>% rho.circular(na.rm=T)
#combine S1/S2 stats
sitemetrics <- data.frame(t(c(S1_Ampl, S1_Phase_Peak, S1_Phase_Peak_rad, S1_Phase_Season, S1_Phase_Season_rad, S1_Phase_Ensemble, S1_Phase_Ensemble_rad, S2_Ampl, S2_Phase_Peak, S2_Phase_Peak_rad, S2_Phase_Season, S2_Phase_Season_rad, S2_Phase_Ensemble, S2_Phase_Ensemble_rad, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)))
sitemetrics_spread <- data.frame(t(c(S1_Ampl_IQR, S1_Phase_Peak_IQR, S1_Phase_Peak_rad_rho, S1_Phase_Season_IQR, S1_Phase_Season_rad_rho, S1_Phase_Ensemble_IQR, S1_Phase_Ensemble_rad_rho, S2_Ampl_IQR, S2_Phase_Peak_IQR, S2_Phase_Peak_rad_rho, S2_Phase_Season_IQR, S2_Phase_Season_rad_rho, S2_Phase_Ensemble_IQR, S2_Phase_Ensemble_rad_rho,  S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)))
comb_metrics <- c(sitemetrics,sitemetrics_spread) %>% data.frame()
colnames(comb_metrics) <- colnames
metrics <- rbind(metrics, comb_metrics)
}
metrics <- cbind(data.frame(site.list), metrics)
names(metrics)[1] <- "study_site"
#get seasonality metrics means and annual variation (IQR and rho measures of spread)
metrics_means <- metrics %>% select(study_site, S2_Ampl, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)
metrics_spread <- metrics %>% select(study_site, S2_Ampl_IQR, S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)
S1_Phase_Ensemble
metrics_means
metrics
S1_Phase_Ensemble_IQR
S2_Phase_Ensemble_IQR
#subtract circular values and fix negative results
circular_diff_fixed <- function(circ_1,circ_2){
if (circ_2 < circ_1) {
return(circ_1 - circ_2)
} else {
return(circ_2 - circ_1)
}
}
#subtract day of year (doy) values and fix negative doy values
doy_diff_fixed <- function(doy_1,doy_2){
if (doy_2 < doy_1) {
return(doy_1 - doy_2)
} else {
return(doy_2 - doy_1)
}
}
hnum <- "multiple"
# Read season data from Timesat output seasonality file
colnames <- c("S1_Ampl", "S1_Phase_Peak", "S1_Phase_Peak_rad", "S1_Phase_Season", "S1_Phase_Season_rad","S1_Phase_Ensemble", "S1_Phase_Ensemble_rad", "S2_Ampl", "S2_Phase_Peak", "S2_Phase_Peak_rad", "S2_Phase_Season", "S2_Phase_Season_rad","S2_Phase_Ensemble", "S2_Phase_Ensemble_rad", "S1_S2_Phase_Peak", "S1_S2_Phase_Peak_rad", "S1_S2_Phase_Season", "S1_S2_Phase_Season_rad", "S1_S2_Phase_Ensemble", "S1_S2_Phase_Ensemble_rad")
colnames_spread <- c("S1_Ampl_IQR", "S1_Phase_Peak_IQR", "S1_Phase_Peak_rho",  "S1_Phase_Season_IQR", "S1_Phase_Season_rho",  "S1_Phase_Ensemble_IQR",  "S1_Phase_Ensemble_rho", "S2_Ampl_IQR", "S2_Phase_Peak_IQR", "S2_Phase_Peak_rho",  "S2_Phase_Season_IQR", "S2_Phase_Season_rho",  "S2_Phase_Ensemble_IQR",  "S2_Phase_Ensemble_rho", "S1_S2_Phase_Peak_IQR", "S1_S2_Phase_Peak_rad_rho", "S1_S2_Phase_Season_IQR", "S1_S2_Phase_Season_rad_rho", "S1_S2_Phase_Ensemble_IQR", "S1_S2_Phase_Ensemble_rad_rho")
colnames <- c(colnames, colnames_spread)
metrics <-data.frame(matrix(NA, nrow=0, ncol=length(colnames))) #empty dataframe to hold phenometrics
#read season function
read_season_data <- function(path, pattern){
dir(path, full.names = TRUE, pattern = pattern) %>%
map(read.csv, header = TRUE)
}
#calculate phenometric function
calculate_season_vars <- function(df){
df %>%
mutate(
stdoy = yday(paste0("1901-", month(season_start_date), "-", day(season_start_date))),
enddoy = yday(paste0("1901-", month(season_end_date), "-", day(season_end_date))),
straddoy = 2*pi*stdoy/365,
endraddoy = 2*pi*enddoy/365,
phase_peak_rad = 2*pi*phase_peak/365,
phase_season_rad = 2*pi*phase_peak/365,
phase_ensemble_rad = 2*pi*phase_ensemble/365)
}
#fix negative circular values
circular_negative_fixed <- function(circ_val){
if (circ_val < 0) {
return(circ_val + 2*pi)
} else {
return(circ_val)
}
}
#subtract circular values and fix negative results
circular_diff_fixed <- function(circ_1,circ_2){
if (circ_2 < circ_1) {
return(circ_1 - circ_2)
} else {
return(circ_2 - circ_1)
}
}
#subtract day of year (doy) values and fix negative doy values
doy_diff_fixed <- function(doy_1,doy_2){
if (doy_2 < doy_1) {
return(doy_1 - doy_2)
} else {
return(doy_2 - doy_1)
}
}
for (site in site.list) {
# Read in seasonality file - multiple harmonic
study_siteID <- match(site,studyarea_bases)  # study site defined above
S1_path <- "/timesat/output/third_run/S1/" ; S2_path <- "/timesat/output/third_run/S2/"
S1_season <- read_season_data(paste0(wd, S1_path), "seasonality_processed.csv")[[study_siteID]]
S2_season <- read_season_data(paste0(wd, S2_path), "seasonality_processed.csv")[[study_siteID]]
#Define season start and end for season length definition
# Call the function on S1_season dataframe
S1_season <- calculate_season_vars(S1_season)
S2_season <- calculate_season_vars(S2_season)
#S1 phenometrics (conventional statistics)
S1_season_start <- S1_season$season_start_date %>% yday %>% median(na.rm=T)
S1_season_end <- S1_season$season_end_date %>% yday %>% median(na.rm=T)
S1_season_def <- c(0, S1_season_start, S1_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S1_season_start > S1_season_end) {S1_season_def[c(2,3)] <- S1_season_def[c(3,2)]}
S1_Ampl <- S1_season$Ampl. %>% median(na.rm=T) ; S1_Ampl_IQR <- S1_season$Ampl. %>% IQR(na.rm=T)
S1_Phase_Peak <- S1_season$phase_peak %>% median(na.rm=T) ; S1_Phase_Peak_IQR <- S1_season$phase_peak %>% IQR(na.rm=T)
S1_Phase_Season <- S1_season$phase_seas %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_season %>% IQR(na.rm=T)
S1_Phase_Ensemble <- median(S1_Phase_Peak, S1_Phase_Season) ; S1_Phase_Ensemble_IQR <- c(S1_season$phase_seas, S1_season$peak) %>% IQR(na.rm=T) %>% sum()
#S1 phenometrics (circular statistics)
S1_season_start_rad <- S1_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_start_rad_rho <- S1_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_end_rad <- S1_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_end_rad_rho <- S1_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_rad_def <- c(0, S1_season_start_rad[1], S1_season_end_rad[1], 2*pi)
S1_Phase_Peak_rad <- S1_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Peak_rad_rho <- S1_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Season_rad <- S1_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Season_rad_rho <- S1_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Ensemble_rad <- S1_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Ensemble_rad_rho <- S1_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#S2 phenometrics (conventional statistics)
S2_season_start <- S2_season$season_start_date %>% yday %>% median(na.rm=T)
S2_season_end <- S2_season$season_end_date %>% yday %>% median(na.rm=T)
S2_season_def <- c(0, S2_season_start, S2_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S2_season_start > S2_season_end) {S2_season_def[c(2,3)] <- S2_season_def[c(3,2)]}
S2_Ampl <- S2_season$Ampl. %>% median(na.rm=T) ; S2_Ampl_IQR <- S2_season$Ampl. %>% IQR(na.rm=T)
S2_Phase_Peak <- S2_season$phase_peak %>% median(na.rm=T) ; S2_Phase_Peak_IQR <- S2_season$phase_peak %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_seas %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_season %>% IQR(na.rm=T)
S2_Phase_Ensemble <- median(S2_Phase_Peak, S2_Phase_Season) ; S2_Phase_Ensemble_IQR <- c(S2_season$phase_seas, S2_season$peak) %>% IQR(na.rm=T) %>% sum()
#S2 phenometrics (circular statistics)
S2_season_start_rad <- S2_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_start_rad_rho <- S2_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_end_rad <- S2_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_end_rad_rho <- S2_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_rad_def <- c(0, S2_season_start_rad[1], S2_season_end_rad[1], 2*pi)
S2_Phase_Peak_rad <- S2_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Peak_rad_rho <- S2_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Season_rad <- S2_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Season_rad_rho <- S2_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Ensemble_rad <- S2_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Ensemble_rad_rho <- S2_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#Calculate Phase Differences (S1/S2)
S1_S2_Phase_Peak <- doy_diff_fixed(S1_Phase_Peak, S2_Phase_Peak)
S1_S2_Phase_Peak_rad <- circular_diff_fixed(S1_Phase_Peak_rad,S2_Phase_Peak_rad)
S1_S2_Phase_Peak_IQR <- S2_season$phase_peak - S1_season$phase_peak[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Peak_IQR <- S1_S2_Phase_Peak_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Peak_rad_rho <- circular(S2_season$phase_peak_rad) - circular(S1_season$phase_peak_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Peak_rad_rho <- S1_S2_Phase_Peak_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Season <- doy_diff_fixed(S1_Phase_Season, S2_Phase_Season)
S1_S2_Phase_Season_rad <- circular_diff_fixed(S1_Phase_Season_rad,S2_Phase_Season_rad)
S1_S2_Phase_Season_IQR <- S2_season$phase_season - S1_season$phase_season[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Season_IQR <- S1_S2_Phase_Season_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Season_rad_rho <- circular(S2_season$phase_season_rad) - circular(S1_season$phase_season_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Season_rad_rho <- S1_S2_Phase_Season_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Ensemble <- doy_diff_fixed(S1_Phase_Ensemble, S2_Phase_Ensemble)
S1_S2_Phase_Ensemble_rad <- circular_diff_fixed(S1_Phase_Ensemble_rad,S2_Phase_Ensemble_rad)
S1_S2_Phase_Ensemble_IQR <- S2_season$phase_ensemble - S1_season$phase_ensemble[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Ensemble_IQR <- S1_S2_Phase_Ensemble_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Ensemble_rad_rho <- circular(S2_season$phase_ensemble_rad) - circular(S1_season$phase_ensemble_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Ensemble_rad_rho <- S1_S2_Phase_Ensemble_rad_rho %>% rho.circular(na.rm=T)
#combine S1/S2 stats
sitemetrics <- data.frame(t(c(S1_Ampl, S1_Phase_Peak, S1_Phase_Peak_rad, S1_Phase_Season, S1_Phase_Season_rad, S1_Phase_Ensemble, S1_Phase_Ensemble_rad, S2_Ampl, S2_Phase_Peak, S2_Phase_Peak_rad, S2_Phase_Season, S2_Phase_Season_rad, S2_Phase_Ensemble, S2_Phase_Ensemble_rad, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)))
sitemetrics_spread <- data.frame(t(c(S1_Ampl_IQR, S1_Phase_Peak_IQR, S1_Phase_Peak_rad_rho, S1_Phase_Season_IQR, S1_Phase_Season_rad_rho, S1_Phase_Ensemble_IQR, S1_Phase_Ensemble_rad_rho, S2_Ampl_IQR, S2_Phase_Peak_IQR, S2_Phase_Peak_rad_rho, S2_Phase_Season_IQR, S2_Phase_Season_rad_rho, S2_Phase_Ensemble_IQR, S2_Phase_Ensemble_rad_rho,  S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)))
comb_metrics <- c(sitemetrics,sitemetrics_spread) %>% data.frame()
colnames(comb_metrics) <- colnames
metrics <- rbind(metrics, comb_metrics)
}
metrics <- cbind(data.frame(site.list), metrics)
names(metrics)[1] <- "study_site"
#get seasonality metrics means and annual variation (IQR and rho measures of spread)
metrics_means <- metrics %>% select(study_site, S2_Ampl, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)
metrics_spread <- metrics %>% select(study_site, S2_Ampl_IQR, S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)
metrics_means
hnum <- "multiple"
# Read season data from Timesat output seasonality file
colnames <- c("S1_Ampl", "S1_Phase_Peak", "S1_Phase_Peak_rad", "S1_Phase_Season", "S1_Phase_Season_rad","S1_Phase_Ensemble", "S1_Phase_Ensemble_rad", "S2_Ampl", "S2_Phase_Peak", "S2_Phase_Peak_rad", "S2_Phase_Season", "S2_Phase_Season_rad","S2_Phase_Ensemble", "S2_Phase_Ensemble_rad", "S1_S2_Phase_Peak", "S1_S2_Phase_Peak_rad", "S1_S2_Phase_Season", "S1_S2_Phase_Season_rad", "S1_S2_Phase_Ensemble", "S1_S2_Phase_Ensemble_rad")
colnames_spread <- c("S1_Ampl_IQR", "S1_Phase_Peak_IQR", "S1_Phase_Peak_rho",  "S1_Phase_Season_IQR", "S1_Phase_Season_rho",  "S1_Phase_Ensemble_IQR",  "S1_Phase_Ensemble_rho", "S2_Ampl_IQR", "S2_Phase_Peak_IQR", "S2_Phase_Peak_rho",  "S2_Phase_Season_IQR", "S2_Phase_Season_rho",  "S2_Phase_Ensemble_IQR",  "S2_Phase_Ensemble_rho", "S1_S2_Phase_Peak_IQR", "S1_S2_Phase_Peak_rad_rho", "S1_S2_Phase_Season_IQR", "S1_S2_Phase_Season_rad_rho", "S1_S2_Phase_Ensemble_IQR", "S1_S2_Phase_Ensemble_rad_rho")
colnames <- c(colnames, colnames_spread)
metrics <-data.frame(matrix(NA, nrow=0, ncol=length(colnames))) #empty dataframe to hold phenometrics
#read season function
read_season_data <- function(path, pattern){
dir(path, full.names = TRUE, pattern = pattern) %>%
map(read.csv, header = TRUE)
}
#calculate phenometric function
calculate_season_vars <- function(df){
df %>%
mutate(
stdoy = yday(paste0("1901-", month(season_start_date), "-", day(season_start_date))),
enddoy = yday(paste0("1901-", month(season_end_date), "-", day(season_end_date))),
straddoy = 2*pi*stdoy/365,
endraddoy = 2*pi*enddoy/365,
phase_peak_rad = 2*pi*phase_peak/365,
phase_season_rad = 2*pi*phase_peak/365,
phase_ensemble_rad = 2*pi*phase_ensemble/365)
}
#fix negative circular values
circular_negative_fixed <- function(circ_val){
if (circ_val < 0) {
return(circ_val + 2*pi)
} else {
return(circ_val)
}
}
#subtract circular values and fix negative results
circular_diff_fixed <- function(circ_1,circ_2){
if (circ_2 < circ_1) {
return(circ_1 - circ_2)
} else {
return(circ_2 - circ_1)
}
}
#subtract day of year (doy) values and fix negative doy values
doy_diff_fixed <- function(doy_1,doy_2){
if (doy_2 < doy_1) {
return(doy_1 - doy_2)
} else {
return(doy_2 - doy_1)
}
}
for (site in site.list) {
# Read in seasonality file - multiple harmonic
study_siteID <- match(site,studyarea_bases)  # study site defined above
S1_path <- "/timesat/output/third_run/S1/" ; S2_path <- "/timesat/output/third_run/S2/"
S1_season <- read_season_data(paste0(wd, S1_path), "seasonality_processed.csv")[[study_siteID]]
S2_season <- read_season_data(paste0(wd, S2_path), "seasonality_processed.csv")[[study_siteID]]
#Define season start and end for season length definition
# Call the function on S1_season dataframe
S1_season <- calculate_season_vars(S1_season)
S2_season <- calculate_season_vars(S2_season)
#S1 phenometrics (conventional statistics)
S1_season_start <- S1_season$season_start_date %>% yday %>% median(na.rm=T)
S1_season_end <- S1_season$season_end_date %>% yday %>% median(na.rm=T)
S1_season_def <- c(0, S1_season_start, S1_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S1_season_start > S1_season_end) {S1_season_def[c(2,3)] <- S1_season_def[c(3,2)]}
S1_Ampl <- S1_season$Ampl. %>% median(na.rm=T) ; S1_Ampl_IQR <- S1_season$Ampl. %>% IQR(na.rm=T)
S1_Phase_Peak <- S1_season$phase_peak %>% median(na.rm=T) ; S1_Phase_Peak_IQR <- S1_season$phase_peak %>% IQR(na.rm=T)
S1_Phase_Season <- S1_season$phase_seas %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_seas%>% IQR(na.rm=T)
S1_Phase_Ensemble <- S1_season$phase_ensemble %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_ensemble %>% IQR(na.rm=T)
#S1 phenometrics (circular statistics)
S1_season_start_rad <- S1_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_start_rad_rho <- S1_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_end_rad <- S1_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_end_rad_rho <- S1_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_rad_def <- c(0, S1_season_start_rad[1], S1_season_end_rad[1], 2*pi)
S1_Phase_Peak_rad <- S1_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Peak_rad_rho <- S1_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Season_rad <- S1_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Season_rad_rho <- S1_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Ensemble_rad <- S1_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Ensemble_rad_rho <- S1_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#S2 phenometrics (conventional statistics)
S2_season_start <- S2_season$season_start_date %>% yday %>% median(na.rm=T)
S2_season_end <- S2_season$season_end_date %>% yday %>% median(na.rm=T)
S2_season_def <- c(0, S2_season_start, S2_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S2_season_start > S2_season_end) {S2_season_def[c(2,3)] <- S2_season_def[c(3,2)]}
S2_Ampl <- S2_season$Ampl. %>% median(na.rm=T) ; S2_Ampl_IQR <- S2_season$Ampl. %>% IQR(na.rm=T)
S2_Phase_Peak <- S2_season$phase_peak %>% median(na.rm=T) ; S2_Phase_Peak_IQR <- S2_season$phase_peak %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_seas %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_seas %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_ensemble %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_ensemble %>% IQR(na.rm=T)
#S2 phenometrics (circular statistics)
S2_season_start_rad <- S2_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_start_rad_rho <- S2_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_end_rad <- S2_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_end_rad_rho <- S2_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_rad_def <- c(0, S2_season_start_rad[1], S2_season_end_rad[1], 2*pi)
S2_Phase_Peak_rad <- S2_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Peak_rad_rho <- S2_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Season_rad <- S2_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Season_rad_rho <- S2_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Ensemble_rad <- S2_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Ensemble_rad_rho <- S2_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#Calculate Phase Differences (S1/S2)
S1_S2_Phase_Peak <- doy_diff_fixed(S1_Phase_Peak, S2_Phase_Peak)
S1_S2_Phase_Peak_rad <- circular_diff_fixed(S1_Phase_Peak_rad,S2_Phase_Peak_rad)
S1_S2_Phase_Peak_IQR <- S2_season$phase_peak - S1_season$phase_peak[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Peak_IQR <- S1_S2_Phase_Peak_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Peak_rad_rho <- circular(S2_season$phase_peak_rad) - circular(S1_season$phase_peak_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Peak_rad_rho <- S1_S2_Phase_Peak_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Season <- doy_diff_fixed(S1_Phase_Season, S2_Phase_Season)
S1_S2_Phase_Season_rad <- circular_diff_fixed(S1_Phase_Season_rad,S2_Phase_Season_rad)
S1_S2_Phase_Season_IQR <- S2_season$phase_season - S1_season$phase_season[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Season_IQR <- S1_S2_Phase_Season_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Season_rad_rho <- circular(S2_season$phase_season_rad) - circular(S1_season$phase_season_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Season_rad_rho <- S1_S2_Phase_Season_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Ensemble <- doy_diff_fixed(S1_Phase_Ensemble, S2_Phase_Ensemble)
S1_S2_Phase_Ensemble_rad <- circular_diff_fixed(S1_Phase_Ensemble_rad,S2_Phase_Ensemble_rad)
S1_S2_Phase_Ensemble_IQR <- S2_season$phase_ensemble - S1_season$phase_ensemble[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Ensemble_IQR <- S1_S2_Phase_Ensemble_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Ensemble_rad_rho <- circular(S2_season$phase_ensemble_rad) - circular(S1_season$phase_ensemble_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Ensemble_rad_rho <- S1_S2_Phase_Ensemble_rad_rho %>% rho.circular(na.rm=T)
#combine S1/S2 stats
sitemetrics <- data.frame(t(c(S1_Ampl, S1_Phase_Peak, S1_Phase_Peak_rad, S1_Phase_Season, S1_Phase_Season_rad, S1_Phase_Ensemble, S1_Phase_Ensemble_rad, S2_Ampl, S2_Phase_Peak, S2_Phase_Peak_rad, S2_Phase_Season, S2_Phase_Season_rad, S2_Phase_Ensemble, S2_Phase_Ensemble_rad, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)))
sitemetrics_spread <- data.frame(t(c(S1_Ampl_IQR, S1_Phase_Peak_IQR, S1_Phase_Peak_rad_rho, S1_Phase_Season_IQR, S1_Phase_Season_rad_rho, S1_Phase_Ensemble_IQR, S1_Phase_Ensemble_rad_rho, S2_Ampl_IQR, S2_Phase_Peak_IQR, S2_Phase_Peak_rad_rho, S2_Phase_Season_IQR, S2_Phase_Season_rad_rho, S2_Phase_Ensemble_IQR, S2_Phase_Ensemble_rad_rho,  S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)))
comb_metrics <- c(sitemetrics,sitemetrics_spread) %>% data.frame()
colnames(comb_metrics) <- colnames
metrics <- rbind(metrics, comb_metrics)
}
metrics <- cbind(data.frame(site.list), metrics)
names(metrics)[1] <- "study_site"
#get seasonality metrics means and annual variation (IQR and rho measures of spread)
metrics_means <- metrics %>% select(study_site, S2_Ampl, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)
metrics_spread <- metrics %>% select(study_site, S2_Ampl_IQR, S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)
metrics_means
circular(S2_season$phase_peak_rad) - circular(S1_season$phase_peak_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Peak_rad_rho
S1_S2_Phase_Season_rad
S2_Phase_Season_rad
S1_Phase_Season_rad
metrics
S2_season$phase_season_rad
S1_season$phase_season_rad
site <- "rio_doce"
# Read in seasonality file - multiple harmonic
study_siteID <- match(site,studyarea_bases)  # study site defined above
S1_path <- "/timesat/output/third_run/S1/" ; S2_path <- "/timesat/output/third_run/S2/"
S1_season <- read_season_data(paste0(wd, S1_path), "seasonality_processed.csv")[[study_siteID]]
S2_season <- read_season_data(paste0(wd, S2_path), "seasonality_processed.csv")[[study_siteID]]
#Define season start and end for season length definition
# Call the function on S1_season dataframe
S1_season <- calculate_season_vars(S1_season)
S2_season <- calculate_season_vars(S2_season)
#S1 phenometrics (conventional statistics)
S1_season_start <- S1_season$season_start_date %>% yday %>% median(na.rm=T)
S1_season_end <- S1_season$season_end_date %>% yday %>% median(na.rm=T)
S1_season_def <- c(0, S1_season_start, S1_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S1_season_start > S1_season_end) {S1_season_def[c(2,3)] <- S1_season_def[c(3,2)]}
S1_Ampl <- S1_season$Ampl. %>% median(na.rm=T) ; S1_Ampl_IQR <- S1_season$Ampl. %>% IQR(na.rm=T)
S1_Phase_Peak <- S1_season$phase_peak %>% median(na.rm=T) ; S1_Phase_Peak_IQR <- S1_season$phase_peak %>% IQR(na.rm=T)
S1_Phase_Season <- S1_season$phase_seas %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_seas%>% IQR(na.rm=T)
S1_Phase_Ensemble <- S1_season$phase_ensemble %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_ensemble %>% IQR(na.rm=T)
#S1 phenometrics (circular statistics)
S1_season_start_rad <- S1_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_start_rad_rho <- S1_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_end_rad <- S1_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_end_rad_rho <- S1_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_rad_def <- c(0, S1_season_start_rad[1], S1_season_end_rad[1], 2*pi)
S1_Phase_Peak_rad <- S1_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Peak_rad_rho <- S1_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Season_rad <- S1_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Season_rad_rho <- S1_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Ensemble_rad <- S1_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Ensemble_rad_rho <- S1_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#S2 phenometrics (conventional statistics)
S2_season_start <- S2_season$season_start_date %>% yday %>% median(na.rm=T)
S2_season_end <- S2_season$season_end_date %>% yday %>% median(na.rm=T)
S2_season_def <- c(0, S2_season_start, S2_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S2_season_start > S2_season_end) {S2_season_def[c(2,3)] <- S2_season_def[c(3,2)]}
S2_Ampl <- S2_season$Ampl. %>% median(na.rm=T) ; S2_Ampl_IQR <- S2_season$Ampl. %>% IQR(na.rm=T)
S2_Phase_Peak <- S2_season$phase_peak %>% median(na.rm=T) ; S2_Phase_Peak_IQR <- S2_season$phase_peak %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_seas %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_seas %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_ensemble %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_ensemble %>% IQR(na.rm=T)
#S2 phenometrics (circular statistics)
S2_season_start_rad <- S2_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_start_rad_rho <- S2_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_end_rad <- S2_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_end_rad_rho <- S2_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_rad_def <- c(0, S2_season_start_rad[1], S2_season_end_rad[1], 2*pi)
S2_Phase_Peak_rad <- S2_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Peak_rad_rho <- S2_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Season_rad <- S2_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Season_rad_rho <- S2_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Ensemble_rad <- S2_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Ensemble_rad_rho <- S2_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#Calculate Phase Differences (S1/S2)
S1_S2_Phase_Peak <- doy_diff_fixed(S1_Phase_Peak, S2_Phase_Peak)
S1_S2_Phase_Peak_rad <- circular_diff_fixed(S1_Phase_Peak_rad,S2_Phase_Peak_rad)
S1_S2_Phase_Peak_IQR <- S2_season$phase_peak - S1_season$phase_peak[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Peak_IQR <- S1_S2_Phase_Peak_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Peak_rad_rho <- circular(S2_season$phase_peak_rad) - circular(S1_season$phase_peak_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Peak_rad_rho <- S1_S2_Phase_Peak_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Season <- doy_diff_fixed(S1_Phase_Season, S2_Phase_Season)
S1_S2_Phase_Season_rad <- circular_diff_fixed(S1_Phase_Season_rad,S2_Phase_Season_rad)
S1_S2_Phase_Season_IQR <- S2_season$phase_season - S1_season$phase_season[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Season_IQR <- S1_S2_Phase_Season_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Season_rad_rho <- circular(m) - circular(S1_season$phase_season_rad[4:dim(S1_season)[1]])
study_siteID <- match(site,studyarea_bases)  # study site defined above
S1_path <- "/timesat/output/third_run/S1/" ; S2_path <- "/timesat/output/third_run/S2/"
S1_season <- read_season_data(paste0(wd, S1_path), "seasonality_processed.csv")[[study_siteID]]
S2_season <- read_season_data(paste0(wd, S2_path), "seasonality_processed.csv")[[study_siteID]]
#Define season start and end for season length definition
# Call the function on S1_season dataframe
S1_season <- calculate_season_vars(S1_season)
S2_season <- calculate_season_vars(S2_season)
#S1 phenometrics (conventional statistics)
S1_season_start <- S1_season$season_start_date %>% yday %>% median(na.rm=T)
S1_season_end <- S1_season$season_end_date %>% yday %>% median(na.rm=T)
S1_season_def <- c(0, S1_season_start, S1_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S1_season_start > S1_season_end) {S1_season_def[c(2,3)] <- S1_season_def[c(3,2)]}
S1_Ampl <- S1_season$Ampl. %>% median(na.rm=T) ; S1_Ampl_IQR <- S1_season$Ampl. %>% IQR(na.rm=T)
S1_Phase_Peak <- S1_season$phase_peak %>% median(na.rm=T) ; S1_Phase_Peak_IQR <- S1_season$phase_peak %>% IQR(na.rm=T)
S1_Phase_Season <- S1_season$phase_seas %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_seas%>% IQR(na.rm=T)
S1_Phase_Ensemble <- S1_season$phase_ensemble %>% median(na.rm=T) ; S1_Phase_Season_IQR <- S1_season$phase_ensemble %>% IQR(na.rm=T)
#S1 phenometrics (circular statistics)
S1_season_start_rad <- S1_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_start_rad_rho <- S1_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_end_rad <- S1_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_season_end_rad_rho <- S1_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S1_season_rad_def <- c(0, S1_season_start_rad[1], S1_season_end_rad[1], 2*pi)
S1_Phase_Peak_rad <- S1_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Peak_rad_rho <- S1_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Season_rad <- S1_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Season_rad_rho <- S1_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S1_Phase_Ensemble_rad <- S1_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S1_Phase_Ensemble_rad_rho <- S1_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#S2 phenometrics (conventional statistics)
S2_season_start <- S2_season$season_start_date %>% yday %>% median(na.rm=T)
S2_season_end <- S2_season$season_end_date %>% yday %>% median(na.rm=T)
S2_season_def <- c(0, S2_season_start, S2_season_end, 365)    # define season intervals
# swap season start/end when season end wraps to following year
if (S2_season_start > S2_season_end) {S2_season_def[c(2,3)] <- S2_season_def[c(3,2)]}
S2_Ampl <- S2_season$Ampl. %>% median(na.rm=T) ; S2_Ampl_IQR <- S2_season$Ampl. %>% IQR(na.rm=T)
S2_Phase_Peak <- S2_season$phase_peak %>% median(na.rm=T) ; S2_Phase_Peak_IQR <- S2_season$phase_peak %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_seas %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_seas %>% IQR(na.rm=T)
S2_Phase_Season <- S2_season$phase_ensemble %>% median(na.rm=T) ; S2_Phase_Season_IQR <- S2_season$phase_ensemble %>% IQR(na.rm=T)
#S2 phenometrics (circular statistics)
S2_season_start_rad <- S2_season$straddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_start_rad_rho <- S2_season$straddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_end_rad <- S2_season$endraddoy %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_season_end_rad_rho <- S2_season$endraddoy %>% circular() %>% rho.circular(na.rm=T)
S2_season_rad_def <- c(0, S2_season_start_rad[1], S2_season_end_rad[1], 2*pi)
S2_Phase_Peak_rad <- S2_season$phase_peak_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Peak_rad_rho <- S2_season$phase_peak_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Season_rad <- S2_season$phase_season_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Season_rad_rho <- S2_season$phase_season_rad %>% circular() %>% rho.circular(na.rm=T)
S2_Phase_Ensemble_rad <- S2_season$phase_ensemble_rad %>% circular() %>% mean(na.rm=T) %>% circular_negative_fixed()
S2_Phase_Ensemble_rad_rho <- S2_season$phase_ensemble_rad %>% circular() %>% rho.circular(na.rm=T)
#Calculate Phase Differences (S1/S2)
S1_S2_Phase_Peak <- doy_diff_fixed(S1_Phase_Peak, S2_Phase_Peak)
S1_S2_Phase_Peak_rad <- circular_diff_fixed(S1_Phase_Peak_rad,S2_Phase_Peak_rad)
S1_S2_Phase_Peak_IQR <- S2_season$phase_peak - S1_season$phase_peak[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Peak_IQR <- S1_S2_Phase_Peak_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Peak_rad_rho <- circular(S2_season$phase_peak_rad) - circular(S1_season$phase_peak_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Peak_rad_rho <- S1_S2_Phase_Peak_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Season <- doy_diff_fixed(S1_Phase_Season, S2_Phase_Season)
S1_S2_Phase_Season_rad <- circular_diff_fixed(S1_Phase_Season_rad,S2_Phase_Season_rad)
S1_S2_Phase_Season_IQR <- S2_season$phase_season - S1_season$phase_season[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Season_IQR <- S1_S2_Phase_Season_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Season_rad_rho <- circular(S2_season$phase_season_rad) - circular(S1_season$phase_season_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Season_rad_rho <- S1_S2_Phase_Season_rad_rho %>% rho.circular(na.rm=T)
S1_S2_Phase_Ensemble <- doy_diff_fixed(S1_Phase_Ensemble, S2_Phase_Ensemble)
S1_S2_Phase_Ensemble_rad <- circular_diff_fixed(S1_Phase_Ensemble_rad,S2_Phase_Ensemble_rad)
S1_S2_Phase_Ensemble_IQR <- S2_season$phase_ensemble - S1_season$phase_ensemble[4:dim(S1_season)[1]] #need consistent year comparisons
S1_S2_Phase_Ensemble_IQR <- S1_S2_Phase_Ensemble_IQR %>% IQR(na.rm=T)
S1_S2_Phase_Ensemble_rad_rho <- circular(S2_season$phase_ensemble_rad) - circular(S1_season$phase_ensemble_rad[4:dim(S1_season)[1]])
S1_S2_Phase_Ensemble_rad_rho <- S1_S2_Phase_Ensemble_rad_rho %>% rho.circular(na.rm=T)
#combine S1/S2 stats
sitemetrics <- data.frame(t(c(S1_Ampl, S1_Phase_Peak, S1_Phase_Peak_rad, S1_Phase_Season, S1_Phase_Season_rad, S1_Phase_Ensemble, S1_Phase_Ensemble_rad, S2_Ampl, S2_Phase_Peak, S2_Phase_Peak_rad, S2_Phase_Season, S2_Phase_Season_rad, S2_Phase_Ensemble, S2_Phase_Ensemble_rad, S1_S2_Phase_Peak, S1_S2_Phase_Peak_rad, S1_S2_Phase_Season, S1_S2_Phase_Season_rad, S1_S2_Phase_Ensemble, S1_S2_Phase_Ensemble_rad)))
sitemetrics_spread <- data.frame(t(c(S1_Ampl_IQR, S1_Phase_Peak_IQR, S1_Phase_Peak_rad_rho, S1_Phase_Season_IQR, S1_Phase_Season_rad_rho, S1_Phase_Ensemble_IQR, S1_Phase_Ensemble_rad_rho, S2_Ampl_IQR, S2_Phase_Peak_IQR, S2_Phase_Peak_rad_rho, S2_Phase_Season_IQR, S2_Phase_Season_rad_rho, S2_Phase_Ensemble_IQR, S2_Phase_Ensemble_rad_rho,  S1_S2_Phase_Peak_IQR, S1_S2_Phase_Peak_rad_rho, S1_S2_Phase_Season_IQR, S1_S2_Phase_Season_rad_rho, S1_S2_Phase_Ensemble_IQR, S1_S2_Phase_Ensemble_rad_rho)))
comb_metrics <- c(sitemetrics,sitemetrics_spread) %>% data.frame()
colnames(comb_metrics) <- colnames
metrics <- rbind(metrics, comb_metrics)
comb_metrics
S1_Phase_Season_rad
S2_Phase_Season_rad
S1_S2_Phase_Season_rad
S2_season_start_rad
S2_season_end_rad
