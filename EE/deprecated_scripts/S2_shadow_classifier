// Image and geometry imports
var shadow = /* color: #cad6c9 */ee.FeatureCollection(
    [ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.075209059265745, -16.315581336189144],
      [-41.07580987408508, -16.31673457151965],
      [-41.07486573651184, -16.318299665742455],
      [-41.07332078411926, -16.317805426813695],
      [-41.07332078411926, -16.315993206730045],
      [-41.07417909100403, -16.315169464781576]]]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.02989045575012, -16.304625261730642],
      [-41.03014794781555, -16.305531426479323],
      [-41.029289640930784, -16.306519965060204],
      [-41.028517164734495, -16.3053666695641],
      [-41.02868882611145, -16.304295746237198]]]),
            {
              "landcover": 0,
              "system:index": "1"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.042765059021605, -16.327689968198783],
      [-41.04190675213684, -16.32744286075096],
      [-41.04190675213684, -16.32661916700349],
      [-41.04259339764465, -16.32661916700349]]]),
            {
              "landcover": 0,
              "system:index": "2"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.05095833465797, -16.32702852653679],
      [-41.05164498016578, -16.32702852653679],
      [-41.05190247223121, -16.327666888157488],
      [-41.051859556886974, -16.32836702431348],
      [-41.05143040344459, -16.32809932549096],
      [-41.050829588625255, -16.327584519033184],
      [-41.05070084259254, -16.32717267289132]]]),
            {
              "landcover": 0,
              "system:index": "3"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.167563404998624, -16.328710263030285],
      [-41.16897961135849, -16.328504341253037],
      [-41.169322934112394, -16.329080921682955],
      [-41.169322934112394, -16.329616316274368],
      [-41.16872211929306, -16.330110525365477],
      [-41.16794964309677, -16.330316445451473],
      [-41.16760632034286, -16.33006934132224],
      [-41.167820897064054, -16.32932802706113]]]),
            {
              "landcover": 0,
              "system:index": "4"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.16584679122909, -16.349054265290906],
      [-41.166790928802335, -16.349424885362815],
      [-41.166790928802335, -16.349836684617895],
      [-41.166533436736906, -16.35049556161999],
      [-41.166018452606046, -16.350248483004684],
      [-41.16537472244247, -16.350248483004684],
      [-41.164816822967374, -16.35020730320508],
      [-41.164044346771085, -16.349919044364718],
      [-41.16374393936142, -16.349218985409692],
      [-41.16546055313095, -16.348971905179404]]]),
            {
              "landcover": 0,
              "system:index": "5"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.060782929129914, -16.36276834165982],
      [-41.06082584447415, -16.363180112769612],
      [-41.06039669103177, -16.363509529031834],
      [-41.05992462224515, -16.363674236954402],
      [-41.05940963811429, -16.363633059986803],
      [-41.05945255345853, -16.362891873083996],
      [-41.059752960868195, -16.362397746918116],
      [-41.060525437064484, -16.362356569681147]]]),
            {
              "landcover": 0,
              "system:index": "6"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.03524829930814, -16.354779810219036],
      [-41.03567745275052, -16.35440920031009],
      [-41.035806198783234, -16.35490334669902],
      [-41.036278267569855, -16.355232776930176],
      [-41.03623535222562, -16.356303421342467],
      [-41.03563453740628, -16.356262242819795],
      [-41.03524829930814, -16.355685742590385],
      [-41.03499080724271, -16.355232776930176]]]),
            {
              "landcover": 0,
              "system:index": "7"
            }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.267379660312834, -16.335820251565274],
      [-41.268624205295744, -16.3356143372758],
      [-41.26905335873813, -16.335820251565274],
      [-41.269096274082365, -16.336520358527054],
      [-41.26939668149203, -16.336437993132293],
      [-41.26939668149203, -16.33676745450314],
      [-41.26948251218051, -16.337302828046415],
      [-41.269096274082365, -16.337673470409687]]]),
            {
            "landcover": 0,
            "system:index": "8"
          })]);
    
var nonshadow = /* color: #aa7233 */ee.FeatureCollection(
    [ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.16382726340786, -16.40999778778539],
              [-41.16382726340786, -16.431897491414354],
              [-41.138249718241845, -16.431897491414354],
              [-41.138249718241845, -16.40999778778539]]]),
                {
                  "landcover": 1,
                  "system:index": "0"
                }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.29325994163052, -16.41905435533533],
              [-41.29325994163052, -16.43173284119473],
              [-41.28296025901333, -16.43173284119473],
              [-41.28296025901333, -16.41905435533533]]]),
                {
                  "landcover": 1,
                  "system:index": "1"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.22699865012661, -16.45395935818094],
              [-41.22699865012661, -16.465483216620655],
              [-41.218415581278954, -16.465483216620655],
              [-41.218415581278954, -16.45395935818094]]]),
                {
                  "landcover": 1,
                  "system:index": "2"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.15443983494789, -16.461416775546628],
              [-41.15443983494789, -16.466684707502683],
              [-41.15066328465492, -16.466684707502683],
              [-41.15066328465492, -16.461416775546628]]]),
                {
                  "landcover": 1,
                  "system:index": "3"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.17684164464027, -16.47557401803023],
              [-41.17684164464027, -16.482652251386497],
              [-41.167228607530895, -16.482652251386497],
              [-41.167228607530895, -16.47557401803023]]]),
                {
                  "landcover": 1,
                  "system:index": "4"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.217182068224254, -16.48775500331757],
              [-41.217182068224254, -16.49112932990707],
              [-41.21323385655433, -16.49112932990707],
              [-41.21323385655433, -16.48775500331757]]]),
                {
                  "landcover": 1,
                  "system:index": "5"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.34017744481117, -16.49746632084242],
              [-41.34017744481117, -16.506847978204124],
              [-41.33571424901039, -16.506847978204124],
              [-41.676118759508434, -16.536142152257963]]]),
                {
                  "landcover": 1,
                  "system:index": "6"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.49963109007071, -16.613289656936256],
              [-41.49963109007071, -16.620527326618497],
              [-41.48933140745352, -16.620527326618497],
              [-41.48933140745352, -16.613289656936256]]]),
                {
                  "landcover": 1,
                  "system:index": "7"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.44607274046133, -16.61592156838955],
              [-41.44607274046133, -16.619540387729153],
              [-41.44263951292227, -16.619540387729153],
              [-41.44263951292227, -16.61592156838955]]]),
                {
                  "landcover": 1,
                  "system:index": "8"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-40.95054091568481, -16.389614550629595],
              [-40.95054091568481, -16.395872515828476],
              [-40.94127120132934, -16.395872515828476],
              [-40.94127120132934, -16.389614550629595]]]),
                {
                  "landcover": 1,
                  "system:index": "9"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.01851882095825, -16.372815860700637],
              [-41.01851882095825, -16.378744975402554],
              [-41.011652365880124, -16.378744975402554],
              [-41.011652365880124, -16.372815860700637]]]),
                {
                  "landcover": 1,
                  "system:index": "10"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-41.125635520177, -16.28188022955779],
              [-41.125635520177, -16.289789352962615],
              [-41.105036154942624, -16.289789352962615],
              [-41.105036154942624, -16.28188022955779]]]),
                {
                  "landcover": 1,
                  "system:index": "11"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-40.99173964615356, -16.3359195432087],
              [-40.99173964615356, -16.33954359735776],
              [-40.98658980484497, -16.33954359735776],
              [-40.98658980484497, -16.3359195432087]]]),
                {
                  "landcover": 1,
                  "system:index": "12"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-40.872949973302, -16.32471749656764],
              [-40.872949973302, -16.33229542187154],
              [-40.861963645177, -16.33229542187154],
              [-40.861963645177, -16.32471749656764]]]),
                {
                  "landcover": 1,
                  "system:index": "12"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-40.894922629552, -16.288800729981347],
              [-40.894922629552, -16.298686735440878],
              [-40.887026206212155, -16.298686735440878],
              [-40.887026206212155, -16.288800729981347]]]),
                {
                  "landcover": 1,
                  "system:index": "13"
        }),
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-40.8235114967395, -16.288141645224584],
              [-40.8235114967395, -16.29308472689652],
              [-40.81733168716919, -16.29308472689652],
              [-40.81733168716919, -16.288141645224584]]]),
                {
                  "landcover": 1,
                  "system:index": "14"
              })]);


var image = ee.Image('COPERNICUS/S2_SR/20181215T130239_20181215T130505_T24KTG')           

var gcps = nonshadow.merge(shadow)

// Overlay the polygons on the image to get training data.
var sample = image.sampleRegions({
  collection: gcps, 
  properties: ['landcover'], 
  scale: 10,
  tileScale: 2
});

// Add a random value field to the sample and use it to approximately split 80%
// of the features into a training set and 20% into a validation set.
sample = sample.randomColumn();
var training = sample.filter('random <= 0.8');
var validation = sample.filter('random > 0.8');

// Train a classifier.
var classifier = ee.Classifier.smileRandomForest(50).train({
  features: training,  
  classProperty: 'landcover', 
  inputProperties: image.bandNames()
});

// // Classify the image.
Map.centerObject(image, 11)
var classified = image.classify(classifier);

//Visualize
var rgbVis = {
    min: 0.0,
    max: 3000,
    bands: ['B4', 'B3', 'B2'],
  };
  
Map.addLayer(image, rgbVis, 'Full Image', false)   
Map.addLayer(classified, {min: 0, max: 3, palette: ['purple', 'grey']}, 'shadow classified image');